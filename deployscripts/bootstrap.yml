- name: Sjekk at fase er angitt
  fail:
    msg: "Hvilken utviklingsfase? Angi som extra var, f.eks: -e fase=utvikle"
  when: fase is not defined

- name: Leser inn konfigurasjon
  include_vars:
    file: ../customizations/common_vars.yml

- name: Leser inn informasjon om alle kunder
  include_vars:
    file: ../customizations/institusjoner.yml
    name: kundedata

- name: Sjekk at kunde som skal igangsettes er angitt
  fail:
    msg: "Vet ikke hvilken kunde du vil igangsette! Angi kunde som extra var, f.eks: -e kunde=ntnu"
  when: kunde is not defined

- name: Sjekk at angitt kunde er gyldig
  fail:
    msg: "Ukjent kunde: {{ kunde }}"
  when: kundedata[kunde] is not defined

- name: Sjekk at Jenkins workspace er angitt
  fail:
    msg: "Hvor er Jenkins workspace? Angi som extra var, f.eks: -e jenkins_workspace=/development/build/workspace"
  when: jenkins_workspace is not defined

- name: Definer *.brage.unit.no virtualhost
  set_fact:
    bragevirtualhost: "{{ (fase == 'produksjon') | ternary(kunde ~ '.brage.unit.no', 'brage-' ~ fase ~ '.bibsys.no') }}"
